# 循环依赖

#### 前置知识 -- 循环依赖在普通的Java SE 中

在spring中，形成这样闭环的依赖情景称为循环依赖。

<img src="../cacheimg/image-20201203214431916.png" alt="image-20201203214431916" style="zoom:50%;" />

1.  构造方法注入，会导致循环依赖的报错，若构造器构造A时，则必须先构造B，而构造B时，又需要构造A，形成类似死锁的死循环。

    <img src="../cacheimg/image-20201203221225016.png" alt="image-20201203221225016" style="zoom: 67%;" />

    <img src="../cacheimg/image-20201203221439353.png" alt="image-20201203221439353" style="zoom:67%;" />

2.  setter方法注入不会导致循环依赖的报错

<img src="../cacheimg/image-20201203221504072.png" alt="image-20201203221504072" style="zoom:67%;" />

<img src="../cacheimg/image-20201203221557190.png" alt="image-20201203221557190" style="zoom:67%;" />

###### 结论：根据上述的原理，说明当构造器注入的方式，在遇到循环依赖时，spring底层无法解决导致报错

------

#### 循环依赖在Spring的容易中

![image-20201203222511681](../cacheimg/image-20201203222511681.png)

###### 重要结论：spring 容器的三级缓存是spring用来解决singleton循环依赖问题的方式，所谓三级缓存即spring容器中的三个map。

<img src="../cacheimg/image-20201203224820212.png" alt="image-20201203224820212" style="zoom:67%;" />